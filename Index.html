<div id="weather-widget" style="
  max-width: 240px;
  background: #f5f1e9; /* beige clair neutre */
  border-radius: 14px;
  padding: 20px;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  color: #4a4a4a;
  box-shadow: 0 4px 10px rgba(0,0,0,0.1);
  text-align: center;
">
  <h3 style="margin-bottom: 15px; font-weight: 600;">MÃ©tÃ©o locale</h3>
  <p id="city" style="font-size: 1.2em; margin: 8px 0;">Chargement...</p>
  <div id="icon" style="font-size: 48px; margin: 10px 0;"></div>
  <p id="temp" style="font-size: 2em; margin: 6px 0; font-weight: 700;"></p>
  <p id="desc" style="font-size: 1em; font-style: italic; margin: 6px 0; text-transform: capitalize;"></p>
</div>

<script>
  const apiKey = 'bee85c5f8eaca0dfbc7b4ba83c08096c'; // Remplace par ta clÃ© API OpenWeatherMap

  const weatherIcons = {
    '01d': 'â˜€ï¸',
    '01n': 'ğŸŒ™',
    '02d': 'ğŸŒ¤ï¸',
    '02n': 'ğŸŒ¤ï¸',
    '03d': 'â›…',
    '03n': 'â›…',
    '04d': 'â˜ï¸',
    '04n': 'â˜ï¸',
    '09d': 'ğŸŒ§ï¸',
    '09n': 'ğŸŒ§ï¸',
    '10d': 'ğŸŒ¦ï¸',
    '10n': 'ğŸŒ¦ï¸',
    '11d': 'â›ˆï¸',
    '11n': 'â›ˆï¸',
    '13d': 'â„ï¸',
    '13n': 'â„ï¸',
    '50d': 'ğŸŒ«ï¸',
    '50n': 'ğŸŒ«ï¸',
  };

  async function fetchWeatherByCoords(lat, lon) {
    try {
      const url = `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&units=metric&lang=fr&appid=${apiKey}`;
      const res = await fetch(url);
      if (!res.ok) throw new Error('Erreur API mÃ©tÃ©o');
      const data = await res.json();

      document.getElementById('city').innerText = data.name;
      document.getElementById('temp').innerText = `${Math.round(data.main.temp)} Â°C`;
      document.getElementById('desc').innerText = data.weather[0].description;
      document.getElementById('icon').innerText = weatherIcons[data.weather[0].icon] || 'â”';

    } catch (err) {
      document.getElementById('city').innerText = 'Erreur mÃ©tÃ©o';
      document.getElementById('temp').innerText = '--';
      document.getElementById('desc').innerText = '';
      document.getElementById('icon').innerText = '';
      console.error(err);
    }
  }

  async function getLocationByIP() {
    try {
      // API gratuite ipapi.co pour gÃ©olocalisation par IP (limite gratuite ~1000 req/jour)
      const res = await fetch('https://ipapi.co/json/');
      if (!res.ok) throw new Error('Erreur gÃ©olocalisation IP');
      const data = await res.json();
      const { latitude, longitude } = data;
      if (latitude && longitude) {
        fetchWeatherByCoords(latitude, longitude);
      } else {
        throw new Error('CoordonnÃ©es introuvables');
      }
    } catch (err) {
      document.getElementById('city').innerText = 'Impossible de dÃ©tecter la localisation';
      document.getElementById('temp').innerText = '--';
      document.getElementById('desc').innerText = '';
      document.getElementById('icon').innerText = '';
      console.error(err);
    }
  }

  getLocationByIP();
</script>

